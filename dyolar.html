<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DYOLAR - La Monnaie Sacr√©e</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #0b0b0b;
      color: #f1f1f1;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      padding: 2em;
      background: #111;
      border-bottom: 3px solid gold;
    }
    h1 {
      font-size: 2.5em;
      color: gold;
    }
    .section {
      padding: 2em 1em;
      max-width: 800px;
      margin: 0 auto;
    }
    .price {
      font-size: 2em;
      margin: 1em 0;
    }
    .change {
      color: lightgreen;
      font-size: 0.8em;
      margin-left: 0.5em;
    }
    canvas#dyolarChart {
      width: 200px !important;  /* 2x plus petit */
      height: 100px !important;
      margin: auto;
      display: block;
    }
    .airdrop {
      background: #222;
      border: 2px dashed gold;
      padding: 2em;
      margin: 2em 0;
    }
    .btn {
      background: gold;
      color: black;
      padding: 0.8em 1.5em;
      border: none;
      cursor: pointer;
      font-size: 1em;
      margin-top: 1em;
    }
    .testimonials {
      font-style: italic;
      margin-top: 1em;
    }
    footer {
      background: #111;
      padding: 1em;
      font-size: 0.9em;
      color: #999;
    }
    /* Zone admin cach√©e par d√©faut */
    #adminPanel {
      display: none;
      background: #222;
      border: 2px solid gold;
      padding: 1em;
      margin: 2em auto;
      max-width: 400px;
      color: gold;
    }
    #adminPanel input {
      padding: 0.4em;
      font-size: 1em;
      width: 150px;
      margin-right: 0.5em;
    }
    #adminMsg {
      margin-top: 0.8em;
      min-height: 1.2em;
    }
  </style>
</head>
<body>
  <header>
    <h1>üí∞ DYOLAR : La Crypto-monnaie du DYOLISSIME</h1>
    <p>Rejoins la COMMU des Crypto BROS !</p>
  </header>

  <div class="section">
    <h2>Cours actuel du $DYOLAR</h2>
    <p class="price">1 DYOLAR = <span id="dyoprice">3.14</span> UPP* <span class="change" id="changeDisplay">+2.21 (+237.58%)</span></p>
    
    <canvas id="dyolarChart" width="200" height="100"></canvas>
    <p>üî∫ Le PSAUME DE CIOCIE fait grimper le march√© !</p>
  </div>

  <div class="section airdrop">
    <h2>üî• Airdrop Sacr√© !</h2>
    <p>R√©clame 69 DYOLARS offerts par le DYOLISSIME.</p>
    <input type="text" id="pseudo" placeholder="Ton nom de BRO" />
    <br />
    <button class="btn" onclick="claimAirdrop()">CLAIMER TON AIRDROP</button>
    <p id="claimMsg"></p>
  </div>

  <div class="section testimonials">
    <p>"Depuis que j‚Äôai investi dans le DYOLAR, mes r√™ves sont devenus des T-poses." ‚Äî @JeanBRO</p>
    <p>"Ma poule m‚Äôa dit d‚Äôacheter encore." ‚Äî @ProphBRO</p>
  </div>

  <footer>
    *Unit√©s de Poulet-P√¢tes ‚Äî DYOLAR‚Ñ¢ n'est pas une vraie crypto (encore) ‚Äî Tout est b√©n√©diction. Gloire au D. üôè
  </footer>

  <!-- Panneau admin cach√© -->
  <div id="adminPanel">
    <h3>üîê Panneau DYOLAR (ADMIN)</h3>
    <input type="number" id="newPriceInput" placeholder="Nouveau prix base" step="0.01" min="0.01" />
    <button class="btn" onclick="setBasePriceFromInput()">Fixer prix</button>
    <p id="adminMsg"></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Variables globales
    let basePrice;
    let priceHistory = [];

    // Chargement des donn√©es depuis localStorage
    function loadData() {
      const storedHistory = localStorage.getItem('dyolarPriceHistory');
      const storedBasePrice = localStorage.getItem('dyolarBasePrice');
      if (storedHistory && storedBasePrice) {
        priceHistory = JSON.parse(storedHistory);
        basePrice = parseFloat(storedBasePrice);
      } else {
        basePrice = 3.14;
        priceHistory = [basePrice];
        saveData();
      }
    }

    // Sauvegarde dans localStorage
    function saveData() {
      localStorage.setItem('dyolarPriceHistory', JSON.stringify(priceHistory));
      localStorage.setItem('dyolarBasePrice', basePrice.toString());
    }

    // Mise √† jour de l‚Äôaffichage du prix + changement en % depuis le premier
    function updatePriceDisplay(currentPrice) {
      document.getElementById('dyoprice').innerText = currentPrice.toFixed(2);

      const initial = priceHistory[0];
      const diff = currentPrice - initial;
      const percent = (diff / initial) * 100;

      const changeElem = document.getElementById('changeDisplay');
      changeElem.innerText = `${diff >= 0 ? '+' : ''}${diff.toFixed(2)} (${percent >= 0 ? '+' : ''}${percent.toFixed(2)}%)`;
      changeElem.style.color = diff >= 0 ? 'lightgreen' : 'crimson';
    }

    // Chart.js setup
    const ctx = document.getElementById('dyolarChart').getContext('2d');
    const dyolarChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Cours du DYOLAR',
          data: [],
          backgroundColor: 'rgba(255, 215, 0, 0.2)',
          borderColor: 'gold',
          borderWidth: 2,
          pointBackgroundColor: 'white',
          tension: 0.3
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: false,
            ticks: {
              color: 'gold'
            }
          },
          x: {
            ticks: {
              color: 'gold'
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: 'gold'
            }
          }
        }
      }
    });

    // Mise √† jour du graphique avec l‚Äôhistorique complet
    function updateChart() {
      // Labels : juste des indices jour (ou minute) depuis d√©but
      dyolarChart.data.labels = priceHistory.map((_, i) => `#${i+1}`);
      dyolarChart.data.datasets[0].data = priceHistory;
      dyolarChart.update();
    }

    // Fixer un nouveau prix base (manuel) et l‚Äôajouter √† l‚Äôhistorique (sans reset)
    function setBasePrice(newPrice) {
      basePrice = newPrice;
      priceHistory.push(newPrice);
      saveData();
      updatePriceDisplay(newPrice);
      updateChart();
      document.getElementById('adminMsg').innerText = `Prix de base fix√© √† ${newPrice.toFixed(2)} UPP.`;
      document.getElementById('adminMsg').style.color = "gold";
      document.getElementById('newPriceInput').value = '';
    }
    function setBasePriceFromInput() {
      const input = document.getElementById('newPriceInput').value.trim();
      if (!input || isNaN(input) || parseFloat(input) <= 0) {
        document.getElementById('adminMsg').innerText = "Entre un nombre positif valide.";
        document.getElementById('adminMsg').style.color = "crimson";
        return;
      }
      setBasePrice(parseFloat(input));
    }

    // Fluctuation automatique (minime) toutes les minutes
    function autoFluctuate() {
      const lastPrice = priceHistory[priceHistory.length - 1];
      let fluctuation = (Math.random() * 0.1) - 0.05; // ¬±0.05 max
      let newPrice = lastPrice + fluctuation;
      if (newPrice < 0.01) newPrice = 0.01;
      priceHistory.push(newPrice);
      saveData();
      updatePriceDisplay(newPrice);
      updateChart();
    }

    // Airdrop faux
    function claimAirdrop() {
      const pseudo = document.getElementById('pseudo').value.trim();
      const msg = document.getElementById('claimMsg');
      if (!pseudo) {
        msg.innerText = "Entre ton pseudo sacr√©, Disciple.";
        msg.style.color = "crimson";
        return;
      }
      msg.innerText = `B√©ni sois-tu, ${pseudo} ! Tu as re√ßu 69 DYOLARS. üõê`;
      msg.style.color = "gold";
    }

    // Acc√®s admin : taper DYOLISECRET pour afficher panneau cach√©
    let keySequence = '';
    const secretCode = 'DYOLISECRET';

    window.addEventListener('keydown', (e) => {
      keySequence += e.key.toUpperCase();
      if (!secretCode.startsWith(keySequence)) {
        keySequence = '';
      } else if (keySequence === secretCode) {
        document.getElementById('adminPanel').style.display = 'block';
        document.getElementById('adminMsg').innerText = 'Panneau admin activ√©.';
        document.getElementById('adminMsg').style.color = 'gold';
        keySequence = '';
      }
    });

    // Initialisation au chargement
    loadData();
    updatePriceDisplay(basePrice);
    updateChart();

    // D√©marrer fluctuation automatique toutes les minutes (60000 ms)
    setInterval(autoFluctuate, 60000);
  </script>
</body>
</html>
